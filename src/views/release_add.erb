<h2>Add release:</h2>
<form id="addReleaseForm" action="/release/add" method="post" enctype="multipart/form-data">
    <label for="name">Title:</label>
    <input type="text" id="title" name="title" required><br>

    <label for="artist">Artist:</label>
    <select id="artist" name="artist_id" required>
        <% @artists.each do |artist| %>
            <option value="<%= artist['id'] %>"><%= artist['name'] %></option>
        <% end %>
    </select><br>

    <label for="length">Length:</label>
    <input type="text" id="length" name="length" required><br>

    <label for="type">Type:</label>
    <select id="type" name="type" required>
        <option value="album">Album</option>
        <option value="single">Single</option>
        <option value="ep">EP</option>
    </select><br>

    <label for="genre">Genre:</label>
    <select id="genreDropdown" required>
        <% @genres.each do |genre| %>
            <% puts(genre) %>
            <option value="<%= genre["id"]%>"><%= genre["name"] %></option>
        <% end %>
    </select>
    <button type="button" id="addGenre">Add genre</button>

    <p>Genres: <span id="genreList"></span></p>

    <label for="release_date">Release Date:</label>
    <input type="date" id="release_date" name="release_date" required><br>

    <label for="img">Upload artwork: </label>
    <input type="file" id="release_artwork" name="release_artwork" accept="image/*"><br>

    <button type="submit">Add release</button>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const addGenreButton = document.getElementById('addGenre');
    const genreDropdown = document.getElementById('genreDropdown');
    const genreList = document.getElementById('genreList');
    const genreListIds = []; // Array to store genre IDs

    addGenreButton.addEventListener('click', function() {
        const selectedGenreId = genreDropdown.value; // Get the selected genre ID
        const selectedGenreName = genreDropdown.options[genreDropdown.selectedIndex].text; // Get the selected genre name

        // Check if the genre is already in the list
        if (!genreListIds.includes(selectedGenreId)) {
            // Create genre item
            const genreItem = document.createElement('span');
            genreItem.textContent = selectedGenreName;
            genreItem.classList.add('genreItem');
            genreList.appendChild(genreItem);

            // Create remove button
            const removeButton = document.createElement('span');
            removeButton.textContent = ' âœ– ';
            removeButton.classList.add('removeGenre');
            removeButton.addEventListener('click', function() {
                genreItem.remove();
                removeButton.remove();
                // Remove the genre ID from the array when removed
                const index = genreListIds.indexOf(selectedGenreId);
                if (index !== -1) {
                    genreListIds.splice(index, 1);
                }
            });
            genreList.appendChild(removeButton);

            // Add the genre ID to the array
            genreListIds.push(selectedGenreId);
        }
    });

    document.getElementById('addReleaseForm').addEventListener('submit', function() {
        // Add genre IDs to the form submission
        const hiddenInput = document.createElement('input');
        hiddenInput.setAttribute('type', 'hidden');
        hiddenInput.setAttribute('name', 'genres');
        hiddenInput.setAttribute('value', JSON.stringify(genreListIds));
        this.appendChild(hiddenInput);
    });
});
</script>